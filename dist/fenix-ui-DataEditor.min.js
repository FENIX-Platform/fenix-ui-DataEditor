define(["jquery","loglevel","bootstrap","eonasdan-bootstrap-datetimepicker","moment","amplify-pubsub"],function(t,e,o,a,r,s){return function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){var n,o;n=[i(2),i(3),i(30),i(31),i(27),i(33)],o=function(t,e,i,n,o,a){function r(i,n,o){$=n,D=new e,D.render(t(i),$,o)}function s(t,e,i){D.setColumns(t,e,i)}function d(){return D.getColumns()}function l(){return D.getCodelists()}function c(){return D.getData()}function u(){return D.getDataWithoutValidation()}function h(t){D.setData(t)}function p(t){D.appendData(t)}function f(){D.removeAllData()}function v(){return D.getColumnsWithDistincts()}function y(t){return"undefined"==typeof t?D.isEditable():void D.isEditable(t)}function g(){D&&D.destroy()}function b(){return D.hasChanged()}function m(t,e){return new i(t,e)}function w(){return n}function E(){return new a}function C(){return new o}var D,$={};return{init:r,setColumns:s,getColumns:d,getCodelists:l,getData:c,getDataWithoutValidation:u,setData:h,appendData:p,removeAllData:f,getColumnsWithDistincts:v,isEditable:y,destroy:g,hasChanged:b,CSV_To_Dataset:m,Validator_CSV:w,Columns_Match:E,Data_Validator:C}}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(e,i){e.exports=t},function(t,e,i){var n,o;n=[i(2),i(4),i(7),i(26),i(27),i(29),i(25)],o=function(t,e,i,n,o,a,r){var s={},d={dataEditorValueChanged:"valueChanged.DataEditor.fenix",dataEditorRowAdded:"rowAdded.DataEditor.fenix",dataEditorRowDeleted:"rowDeleted.DataEditor.fenix"},l=function(e){console.log("DataEdit"),this.config={},t.extend(!0,this.config,s,e),this.$container,this.dataEditor,this.$dataEditor,this.valResView,this.$valResView,this.cols,this.codelists,this.editEnabled=!0,this.changed=!1};l.prototype.render=function(e,o,s){console.log("Render - creation"),t.extend(!0,this.config,o),this.$container=e,this.$container.html(a),this.$dataEditor=this.$container.find("#divDataEditor"),this.dataEditor=new i,this.dataEditor.render(this.$container.find("#divDataEdit"),this.config),this.$valResView=this.$container.find("#divValRes"),this.valResView=new n(this.config.lang),this.valResView.render(this.$valResView),this.doML();var l=this;r.subscribe(d.dataEditorValueChanged,this,this.updateValidationOnChange),r.subscribe(d.dataEditorRowAdded,this,this.updateValidationOnChange),r.subscribe(d.dataEditorRowDeleted,this,this.updateValidationOnChange),this.$dataEditor.find("#btnAddRow").on("click",function(t){l.dataEditor.newRow()}),s&&s()},l.prototype.updateValidation=function(t){this.changed=!0;var e=new o,i=e.validate(this.cols,this.codelists,t);this.updateValRes(i),this.dataEditor.showValidationResults(i)},l.prototype.updateValidationOnChange=function(t){this.updateValidation(t.allData)},l.prototype.updateValRes=function(t){t?0==t.length?this.$valResView.hide():(this.$valResView.show(),this.valResView.setValidationResults(t)):this.$valResView.hide()},l.prototype.getValidationResults=function(){var t=new o;return t.validate(this.cols,this.codelists,this.dataEditor.getData())},l.prototype.setColumns=function(t,e,i){if(this.cols=t,this.codelists=e,!this.cols||0==this.cols.length)throw new Error("At least one column must be defined");this.uiEnabled(!1),c(this.cols,this.codelists),this.dataEditor.setColumns(this.cols,this.codelists,i),this.uiEnabled(!0)},l.prototype.getColumns=function(){return this.cols},l.prototype.getCodelists=function(){return this.codelists},l.prototype.uiEnabled=function(t){t?(this.$dataEditor.find("#btnAddRow").removeAttr("disabled"),this.$dataEditor.removeAttr("disabled")):(this.$dataEditor.find("#btnAddRow").attr("disabled","disabled"),this.$dataEditor.attr("disabled","disabled"))};var c=function(t,e){if(t)for(var i=0;i<t.length;i++)if("code"==t[i].dataType){if(!e)throw new Error("Codelist for the column "+t[i].id+" missing");var n=t[i].domain.codes[0].idCodeList;if(t[i].domain.codes[0].version&&(n=n+"|"+t[i].domain.codes[0].version),!(n in e))throw new Error("Codelist '"+n+"' for the column '"+t[i].id+"' missing")}};l.prototype.getData=function(){var t=this.getValidationResults();return(null==t||0==t.length)&&this.dataEditor.getData()},l.prototype.getDataWithoutValidation=function(){return this.dataEditor.getData()},l.prototype.setData=function(t){this.cols&&this.dataEditor.setData(t),this.updateValidation(t),this.changed=!1},l.prototype.removeAllData=function(){this.dataEditor.removeAllData()},l.prototype.hasChanged=function(){return this.changed},l.prototype.getColumnsWithDistincts=function(){for(var t=this.dataEditor.getData(),e=0;e<this.cols.length;e++){var i=this.cols[e];switch(i.dataType){case"code":case"customCode":var n=u(t,e);if(n){i.values={codes:[]},i.values.codes[0]={idCodeList:i.domain.codes[0].idCodeList},i.domain.codes[0].version&&(i.values.codes[0].version=i.domain.codes[0].version),i.values.codes[0].codes=[];for(var o=0;o<n.length;o++)i.values.codes[0].codes.push({code:n[o]})}else i.values=null;break;case"date":case"month":case"year":var n=u(t,e);n?i.values={timeList:n}:i.values=null}}return this.cols};var u=function(e,i){var n=[];if(!e)return null;for(var o=0;o<e.length;o++)t.inArray(e[o][i],n)==-1&&n.push(e[o][i]);return n};return l.prototype.isEditable=function(t){return"undefined"==typeof t?this.editEnabled:(t?this.$dataEditor.find("#btnAddRow").show():this.$dataEditor.find("#btnAddRow").hide(),this.editEnabled=t,this.dataEditor.isEditable(t),void 0)},l.prototype.destroy=function(){r.unsubscribe(d.dataEditorValueChanged,this.updateValidation),r.unsubscribe(d.dataEditorRowAdded,this.updateValidation),r.unsubscribe(d.dataEditorRowDeleted,this.updateValidation),this.$dataEditor.find("#btnAddRow").off("click"),this.dataEditor.destroy()},l.prototype.doML=function(){this.$dataEditor.find("#btnAddRow").html(e.add)},l}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n,o;n=[i(5),i(6)],o=function(t,e){"use strict";return{en:t,fr:e}}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n;n=function(){"use strict";return{confirmDelete:"Delete?",unsavedData:"Some changes are unsaved, cancel anyway?",nullKey:"Key fields cannot be empty",sameKeyVals:"Key fields cannot be duplicated",unknownCode:"Unknown code",invalidYear:"Year is not valid",invalidMonth:"Month is not valid",invalidDate:"Date is not valid",invalidNumber:"Number is not valid",invalidBool:"Boolean is not valid",NAN:"Value is not a number",OutOfRange:"Value is out of the allowed range",Null:"Value cannot be blank"}}.call(e,i,e,t),!(void 0!==n&&(t.exports=n))},function(t,e,i){var n;n=function(){"use strict";return{confirmDelete:"Supprimer?",unsavedData:"Certains changements n'ont pas été enregistrés, annuler quand même?",nullKey:"Les champs clés ne peuvent pas être vides",sameKeyVals:"Les champs clés ne peuvent pas être dupliqués",unknownCode:"Code inconnu",invalidYear:"L'année n'est pas valable",invalidMonth:"Le mois n'est pas valable",invalidDate:"La date n'est pas valable",invalidNumber:"Le nombre n'est pas valable",invalidBool:"Booléen n'est pas valable",NAN:"La valeur n'est pas numérique",OutOfRange:"La valeur est hors de la plage autorisée",Null:"La valeur ne peut pas être vide"}}.call(e,i,e,t),!(void 0!==n&&(t.exports=n))},function(t,e,i){var n,o;n=[i(2),i(8),i(9),i(23),i(4),i(24),i(25),i(13)],o=function(t,e,i,n,o,a,r){function s(t,e,i,n,o){var a="<tr>";a+="<td>"+t+"</td>";for(var r=0;r<e.length;r++)a+="<td>",a+=null===n[r]?"":"code"==e[r].dataType?d(e[r],i,n[r],this.lang):n[r],a+="</td>";return o&&(a+="<td>"+g.btnEdit.replace("%idx%",t)+"</td>",a+="<td>"+g.btnDel.replace("%idx%",t)+"</td>"),a+="</tr>"}function d(t,e,i){var n=w(t.domain),o=E(e[n].data,i);return null===o?"":o}function l(t,e){var i={};for(var n in t)i[n]={metadata:{}},i[n].data=c(t[n].data,e);return i}function c(t,e){if(!t)return null;var i=[];return u(t,i,e),i}function u(t,e,i){if(t)for(var n=0;n<t.length;n++)e.push(h(t[n],i)),t[n].children&&u(t[n].children,e)}function h(t,e){var i=function(t,e){if(!t)return"";if(e||(e="EN"),e=e.toUpperCase(),e in t)return e;if("EN"in t)return"EN";for(var i in t)return i};return{level:t.level,title:t.title[i(t.title,e)]+" ["+t.code+"]",code:t.code}}var p="DataEditor",f={thButtons:"<th>E</th><th>D</th>"},v={EVT_VALUE_CHANGED:"valueChanged."+p+".fenix",EVT_ROW_ADDED:"rowAdded."+p+".fenix",EVT_ROW_DELETED:"rowDeleted."+p+".fenix"},y={divDataGrid:"#divDataGrid",divRowEditorPopup:"#divRowEditorPopup",btnEditRowCanc:"#btnEditRowCanc",btnEditRowOk:"#btnEditRowOk",tblDataBody:"#tblDataBody",tblDataHead:"#tblDataHead",editButtonsClass:"bE",delButtonsClass:"bD"},g={btnEdit:'<button type="button" class="btn btn-default bE" data-rid=%idx%><span class="glyphicon glyphicon-pencil"></span></button>',btnDel:'<button type="button" class="btn btn-default bD"data-rid=%idx%><span class="glyphicon glyphicon-trash"></span></button>'},b=function(e){this.config={},t.extend(!0,this.config,e,f),this.rowEditor=new i,this.$cnt,this.$editWindow,this.$dataGrid,this.cols,this.codelists,this.data=[],this.$tBody,this.editEnabled=!0,this.lang="en"};b.prototype.render=function(i,o,a){t.extend(!0,this.config,o),this.$cnt=i,this.$cnt.html(n),this.$dataGrid=this.$cnt.find(y.divDataGrid),this.$editWindow=this.$cnt.find(y.divRowEditorPopup),this.rowEditor.render(this.$editWindow),localStorage.getItem("locale")&&(this.lang=localStorage.getItem("locale")),this._bindEvents(),this.$tBody=this.$cnt.find(y.tblDataBody),this._doML(),a&&a(),e.info("DataEditor rendered",this.config)},b.prototype.setColumns=function(t,e,i){this.cols=t,this.codelists=l(e,this.lang),t&&(this.updateTableHeader(),this.rowEditor.setColumns(this.cols,this.codelists),i&&i())};var m=function(t){return"<th>"+t+"</th>"};b.prototype._showEditWindow=function(t){e.info("_showEditWindow",t),this.$editWindow.modal("show"),this.rowEditor.reset(),t&&this.rowEditor.setRow(t);var i=this;this.$editWindow.on("keyup",function(t){13==t.keyCode&&i.rowEditOk()})},b.prototype._bindEvents=function(){e.info("Data Editor - _bindEvents");var t=this;this.$cnt.find(y.btnEditRowCanc).on("click",function(){t.rowEditor.changed()&&!confirm(o[t.lang].unsavedData)||t.$editWindow.modal("hide")}),this.$cnt.find(y.btnEditRowOk).on("click",function(){t.rowEditOk()}),this.$editWindow.on("hidden.bs.modal",function(e){t.rowEditor.reset(),t.$editWindow.off("keyup")})},b.prototype._unbindEvents=function(){this.$cnt.find(y.btnEditRowCanc).off("click"),this.$cnt.find(y.btnEditRowOk).off("click"),this.$editWindow.off("hidden.bs.modal"),this.$tBody.find("."+y.editButtonsClass).off("click"),this.$tBody.find("."+y.delButtonsClass).off("click")},b.prototype.destroy=function(){this._unbindEvents(),this.rowEditor.destroy(),this.$tBody.html("")},b.prototype.rowEditOk=function(){if(!this.rowEditor.isValid())return void this.rowEditor.updateValidationHelp();var t=this.rowEditor.getRow();if(t.uid!=-1){this.data[t.uid]=t.data;var e={};e.newData=t.data,e.allData=this.data,r.publish(v.EVT_VALUE_CHANGED,e)}else{this.data.push(t.data);var e={};e.allData=this.data,r.publish(v.EVT_ROW_ADDED,e)}this.updateTable(),this.$editWindow.modal("hide")},b.prototype.newRow=function(){this._showEditWindow(null)},b.prototype.isEditable=function(t){if(console.log("isEditable",t),this.editEnabled=t,this.cols){if("undefined"==typeof t)return this.editEnabled;this.updateTableHeader(),this.updateTable()}},b.prototype.setData=function(t){if(!this.cols)throw new Error("Cannot set data without table structure, use setColumns before setData");t&&(this.data=t,this.updateTable())},b.prototype.removeAllData=function(){this.data=[],this.updateTable()},b.prototype.updateTableHeader=function(){var t=this.$cnt.find(y.tblDataHead);t.html(""),t.append("<th>#</th>");for(var e=0;e<this.cols.length;e++)t.append(m(this.cols[e].title[this.lang.toUpperCase()]));this.editEnabled&&t.append(this.config.thButtons)},b.prototype.updateTable=function(){if(this.$tBody.html(""),this.data){for(var e=0;e<this.data.length;e++)this.$tBody.append(s(e,this.cols,this.codelists,this.data[e],this.editEnabled));if(this.editEnabled){var i=this;this.$tBody.find("."+y.editButtonsClass).on("click",function(){var e=t(this).data("rid");i._showEditWindow({uid:e,data:i.data[e]})}),this.$tBody.find("."+y.delButtonsClass).on("click",function(){var e=confirm(o[i.lang].confirmDelete);e&&i.deleteRow(t(this).data("rid"))})}}},b.prototype.deleteRow=function(t){this.data.splice(t,1),this.updateTable(),r.publish(v.EVT_ROW_DELETED,this.data)},b.prototype.getRowByRowId=function(e){for(var i=this.$tBody.find("tr"),n=0;n<i.length;n++)if(e==t(i[n]).find("td:first").html())return t(i[n]);return null};var w=function(t){var e=t.codes[0].idCodeList;return t.codes[0].version&&(e+="|"+t.codes[0].version),e},E=function(t,e){if(!t)return null;for(var i=0;i<t.length;i++)if(t[i].code==e)return t[i].title;return null};return b.prototype.getData=function(){return e.info("getData ",this.data),this.data},b.prototype.showValidationResults=function(t){},b.prototype.resetValidationResults=function(){},b.prototype.setRowColor=function(t,e){},b.prototype.setCellColor=function(t,e,i){},b.prototype.setCellError=function(t,e){},b.prototype.changeCellBackgroundColor=function(t,e){},b.prototype._doML=function(){},b}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,i){t.exports=e},function(t,e,i){var n,o;n=[i(2),i(8),i(4),i(10)],o=function(t,e,i,n){function o(t){return"trRowEdit_"+t}var a={YMin:0,YMax:3e3,decimalDigits:5},n=new n,r=function(e){this.config={},t.extend(!0,this.config,a,e),this.$window,this.cols,this.codelists,this.lang="EN",localStorage.getItem("locale")&&(this.lang=localStorage.getItem("locale")),this.lang=this.lang.toLowerCase(),this.editors=[],this.uidInEdit=-1,this.oldVal=null};return r.prototype.render=function(e,i){t.extend(!0,this.config,i),this.$window=e},r.prototype.setColumns=function(t,e){this.cols=t,this.codelists=e,t&&this.createStrucure()},r.prototype.createStrucure=function(){this.editors=[];for(var t,e=this.$window.find("#tblRowEditor"),i=e.find("tbody"),a=0;a<this.cols.length;a++)t="<tr>",t+="<td>"+this.cols[a].title[this.lang.toUpperCase()]+"</td>",t+='<td><div id="'+o(this.cols[a].id)+'"></div></td>',t+="</tr>",i.append(t);for(var a=0;a<this.cols.length;a++){var r=this.cols[a],s=i.find("#"+o(r.id)),d=null;switch(this.editors[a]=n.create(r.dataType,d),r.dataType){case"code":var l=r.domain.codes[0].idCodeList;r.domain.codes[0].version&&(l+="|"+r.domain.codes[0].version),this.editors[a].render(s,null,[this.codelists[l]]);break;case"customCode":break;case"year":var c=this.config.YMin,u=this.config.YMax;r.domain&&r.domain.period&&(c=r.domain.period.from,u=r.domain.period.to),this.editors[a].render(s,{yMin:c,yMax:u});break;case"number":case"percentage":this.editors[a].render(s,{decimalDigits:this.config.decimalDigits});break;case"month":case"date":case"text":case"bool":this.editors[a].render(s,null)}r.key&&this.editors[a].isMandatory(!0)}},r.prototype.reset=function(t){if(e.info("RowEditorPopup - reset",this.editors,this.cols.length,t),this.uidInEdit=-1,this.cols){for(var i=0;i<this.cols.length;i++)this.editors[i].reset();this.oldVal=null}},r.prototype.updateValidationHelp=function(){if(this.cols)for(var t=0;t<this.cols.length;t++)this.editors[t].updateValidationHelp&&this.editors[t].updateValidationHelp()},r.prototype.isValid=function(){for(var t=0;t<this.cols.length;t++)if(!this.editors[t].isValid())return!1;return!0},r.prototype.setRow=function(t){if(e.info("setRow",t),this.reset(),!this.cols)throw new Error("cannot set row when columns are null");this.oldVal=t,"undefined"!=t.uid?this.uidInEdit=t.uid:this.uidInEdit=-1;for(var i=0;i<this.cols.length;i++){if(!this.editors[i])throw new Error("Editor cannot be null for dataType "+this.cols[i].dataType);this.editors[i].setValue(t.data[i])}},r.prototype.getRow=function(t){if(!this.cols)throw new Error("cannot get row when columns are null");for(var e={uid:this.uidInEdit,data:[]},i=0;i<this.cols.length;i++){var n=this.editors[i].getValue();n?"number"==this.cols[i].dataType||"percentage"==this.cols[i].dataType?e.data[i]=parseFloat(n):e.data[i]=n:e.data[i]=null}return e},r.prototype.changed=function(){var t=this.getRow();if(null==this.oldVal){for(var e=0;e<this.cols.length;e++)if(""!=t.data[e])return!0}else for(var e=0;e<this.cols.length;e++)if(t.data[e]!=this.oldVal.data[e])return!0;return!1},r.prototype.destroy=function(){if(this.cols)for(var t=0;t<this.cols.length;t++)this.editors[t].destroy()},r}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n,o;n=[i(2),i(11),i(14),i(15),i(19),i(20),i(21),i(22)],o=function(t,e,i,n,o,a,r,s){var d={},l=function(e){this.config={},t.extend(!0,this.config,d,e)};return l.prototype.create=function(t,d){switch(t){case"code":return new i(d);case"customCode":break;case"year":return new s(d);case"month":return new o(d);case"date":return new n(d);case"number":case"percentage":return new a(d);case"text":return new r(d);case"bool":return new e(d)}},l}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n,o;n=[i(2),i(4),i(12),i(13)],o=function(t,e,i){var n=function(t){this.parent.constructor.call(this,t)};return n.prototype=Object.create(i.prototype),n.prototype.constructor=n,n.prototype.parent=i.prototype,n.prototype.render=function(e,i){t.extend(!0,this.config,i),this.$cnt=e;var n='<input type="checkbox" />';this.$cnt.html(n);var o=this,a=this.$cnt.find("input");a.show(),a.on("click",function(){o.updateValidationHelp()})},n.prototype.destroy=function(){this.$cnt.find("input").off("click")},n.prototype.updateValidationHelp=function(){var t=this.validate();this.parent.updateValidationHelp.call(this,t)},n.prototype.reset=function(){this.$cnt.find("input").prop("checked",!1),this.$cnt.popover("destroy")},n.prototype.setValue=function(t){this.reset(),this.$cnt.find("input").prop("checked",t)},n.prototype.getValue=function(){return this.$cnt.find("input").prop("checked")},n.prototype.isMandatory=function(t){return"undefined"==t?this.mandatory:void(this.mandatory=t)},n.prototype.validate=function(){return null},n.prototype.isValid=function(){return null==this.validate()},n}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n,o;n=[i(2),i(4),i(13)],o=function(t,e){var i={},n=function(e){this.config={},t.extend(!0,this.config,i,e),this.$cnt,this.mandatory=!1,this.ERROR_NAN="NAN",this.ERROR_OUT_OF_RANGE="OutOfRange",this.ERROR_NULL="Null"};return n.prototype.updateValidationHelp=function(){var t=this.validate();if(null==t)this.$cnt.popover("destroy");else{var i=e[t];this.$cnt.popover({container:this.$cnt,content:i,html:!0}),this.$cnt.popover("show")}},n.prototype.isMandatory=function(t){return"undefined"==t?this.mandatory:void(this.mandatory=t)},n.prototype.isValid=function(){return null==this.validate()},n}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e){t.exports=o},function(t,e,i){var n,o;n=[i(2),i(4),i(12),i(13)],o=function(t,e,i){function n(t,e,i){if(0==t)return title;var n=o.optionCode;n=n.replace("%lev%",e);var a="";switch(e){case 2:a="&nbsp;";break;case 3:a="&nbsp;&nbsp;";break;case 4:a="&nbsp;&nbsp;&nbsp;";break;default:a="&nbsp;&nbsp;&nbsp;&nbsp;"}return n.replace("%label%",a+""+i)}var o={elemCode:'<select class="%class%"></select>',elemClass:"form-control",optionCode:'<span class="cl_lev%lev%">%label%</span>',emptyEntryValue:"-",emptyEntryLabel:"-"},a=function(e){this.parent.constructor.call(this,e),t.extend(!0,this.config,o),this.codelists,this.$ddl};return a.prototype=Object.create(i.prototype),a.prototype.constructor=a,a.prototype.parent=i.prototype,a.prototype.render=function(e,i,n){t.extend(!0,this.config,i),this.$cnt=e,this.codelists=n,this.createEditor()},a.prototype.createEditor=function(){var e=o.elemCode.replace("%class%",o.elemClass);if(this.$ddl=t(e),this.codelists&&this.codelists[0]&&this.codelists[0].data){var i=t("<option></option>");i.val(this.config.emptyEntryValue),i.html(this.config.emptyEntryLabel),this.$ddl.append(i);for(var a=0;a<this.codelists[0].data.length;a++)i=t("<option></option>").val(this.codelists[0].data[a].code),i.html(n(this.codelists[0].metadata.levels,this.codelists[0].data[a].level,this.codelists[0].data[a].title)),this.$ddl.append(i);this.$cnt.append(this.$ddl),this._bindEvents()}},a.prototype._bindEvents=function(){var t=this;this.$cnt.on("select",function(){t.updateValidationHelp()})},a.prototype._unbindEvents=function(){this.$cnt.off("select")},a.prototype.destroy=function(){this._unbindEvents()},a.prototype.updateValidationHelp=function(){var t=this.validate();this.parent.updateValidationHelp.call(this,t)},a.prototype.reset=function(){this.$ddl.val(this.config.emptyEntryValue)},a.prototype.setValue=function(t){this.reset(),this.$ddl.val(t),this.updateValidationHelp()},a.prototype.getValue=function(){var t=this.$ddl.val();return t==this.config.emptyEntryValue?"":t},a.prototype.isMandatory=function(t){return"undefined"==t?this.mandatory:void(this.mandatory=t)},a.prototype.validate=function(){var t=this.getValue();return this.mandatory&&!t?this.ERROR_NULL:null},a.prototype.isValid=function(){return null==this.validate()},a}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n,o;n=[i(2),i(16),i(4),i(12),i(17),i(18),i(13)],o=function(t,e,i,n,o){var a={yMin:0,yMax:3e3},r=function(e){this.parent.constructor.call(this,e),t.extend(!0,this.config,a),this.$datePicker};return r.prototype=Object.create(n.prototype),r.prototype.constructor=n,r.prototype.parent=n.prototype,r.prototype.render=function(e,i){t.extend(!0,this.config,i),this.$cnt=e,this.$cnt.html(o),this.$datePicker=this.$cnt.find("#inputTime"),this.$datePicker.datetimepicker({viewMode:"days",locale:"en",format:"DD/MM/YYYY"});var n=this;this.$cnt.on("change",function(){n.updateValidationHelp()})},r.prototype.destroy=function(){this.$datePicker.data("DateTimePicker").destroy(),this.$datePicker.off("change")},r.prototype.reset=function(){this.$datePicker.data("DateTimePicker").clear()},r.prototype.setValue=function(t){if(this.reset(),t){t=""+t;var e=t.substring(6,8),i=t.substring(4,6);i-=1;var n=t.substring(0,4);this.$datePicker.data("DateTimePicker").date(new Date(n,i,e))}},r.prototype.getValue=function(){var t=this.$datePicker.data("DateTimePicker").date();if(!t)return"";var e=""+t.date(),i=""+(t.month()+1),n=""+t.year();for(1==e.length&&(e="0"+e),1==i.length&&(i="0"+i);n.length<4;)n="0"+n;return n+i+e},r.prototype.validate=function(){var t=this.getValue();if(this.mandatory&&!t)return this.ERROR_NULL;var e=t.substring(4,8);return e<this.config.yMin?this.ERROR_OUT_OF_RANGE:e>this.config.yMax?this.ERROR_OUT_OF_RANGE:null},r}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e){t.exports=a},function(t,e){t.exports='<div class="input-group date" id=inputTime> <input type=text class=form-control /> <span class=input-group-addon> <span class="glyphicon glyphicon-calendar"></span> </span> </div>'},function(t,e){t.exports=r},function(t,e,i){var n,o;n=[i(2),i(4),i(15),i(13)],o=function(t,e,i){var n=function(t){this.parent.constructor.call(this,t)};return n.prototype=Object.create(i.prototype),n.prototype.constructor=i,n.prototype.parent=i.prototype,n.prototype.render=function(e,i){t.extend(!0,this.config,i),this.parent.render.call(this,e,i),this.$datePicker.data("DateTimePicker").format("MM/YYYY"),this.$datePicker.data("DateTimePicker").viewMode("months")},n.prototype.setValue=function(t){if(this.reset(),t){var e=t.substring(0,4)+"",i=t.substring(4,6)+"";i-=1,this.$datePicker.data("DateTimePicker").date(new Date(e,i,1))}},n.prototype.getValue=function(){var t=this.$datePicker.data("DateTimePicker").date();if(!t)return"";var e=""+(t.month()+1),i=""+t.year();for(1==e.length&&(e="0"+e);i.length<4;)i="0"+i;return i+e},n.prototype.validate=function(){var t=this.getValue();if(this.mandatory&&!t)return this.ERROR_NULL;if(!t)return null;var e=t.substring(0,4),i=t.substring(4,6);return!this.mandatory||""!=i&&""!=e?e<this.config.yMin||e>this.config.yMax?this.ERROR_OUT_OF_RANGE:""==i&&""==e?null:void 0:this.ERROR_NULL},n}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n,o;n=[i(2),i(4),i(12),i(13)],o=function(t,e,i){var n={decimalDigits:5,html:'<input type="input" class="form-control">'},o=function(e){this.parent.constructor.call(this,e),t.extend(!0,this.config,n),this.$cnt,this.$txt};return o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.parent=i.prototype,o.prototype.render=function(e,i){t.extend(!0,this.config,i),this.$cnt=e,this.$cnt.html(this.config.html),this.$txt=this.$cnt.find("input");var n=this;this.$cnt.on("valueChanged",function(){n.updateValidationHelp()})},o.prototype.destroy=function(){this.$cnt.off("valueChanged")},o.prototype.updateValidationHelp=function(){var t=this.validate();this.parent.updateValidationHelp.call(this,t)},o.prototype.reset=function(){this.$txt.val(""),this.$cnt.popover("destroy")},o.prototype.setValue=function(t){this.reset(),this.$txt.val(t)},o.prototype.getValue=function(){var t=this.$txt.val().trim();return t},o.prototype.isMandatory=function(t){return"undefined"==t?this.mandatory:void(this.mandatory=t)},o.prototype.validate=function(){var t=this.getValue();if(""!=t){if(isNaN(t))return this.ERROR_NAN}else if(this.mandatory)return this.ERROR_NULL;return null},o.prototype.isValid=function(){return null==this.validate()},o}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n,o;n=[i(2),i(4),i(12),i(13)],o=function(t,e,i){var n={html:'<input type="text" class="form-control">'},o=function(e){this.parent.constructor.call(this,e,n),t.extend(!0,this.config,n),this.$cnt,this.txt};return o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.parent=i.prototype,o.prototype.render=function(e,i){t.extend(!0,this.config,i),this.$cnt=e,this.$cnt.html(this.config.html),this.txt=this.$cnt.find("input");var n=this;this.$cnt.on("valueChanged",function(){n.updateValidationHelp()})},o.prototype.destroy=function(){this.$cnt.off("valuechanged")},o.prototype.updateValidationHelp=function(){var t=this.validate();this.parent.updateValidationHelp.call(this,t)},o.prototype.reset=function(){this.txt.val(""),this.$cnt.popover("destroy")},o.prototype.setValue=function(t){this.reset(),this.txt.val(t)},o.prototype.getValue=function(){return this.txt.val().trim()},o.prototype.isMandatory=function(t){return"undefined"==t?this.mandatory:void(this.mandatory=t)},o.prototype.validate=function(){var t=this.getValue();return this.mandatory&&""==t.trim()?this.ERROR_NULL:null},o.prototype.isValid=function(){return null==this.validate()},o}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var n,o;n=[i(2),i(4),i(15),i(13)],o=function(t,e,i){var n=function(t){this.parent.constructor.call(this,t)};return n.prototype=Object.create(i.prototype),n.prototype.constructor=i,n.prototype.parent=i.prototype,n.prototype.render=function(e,i){t.extend(!0,this.config,i),this.parent.render.call(this,e,i),this.$datePicker.data("DateTimePicker").format("YYYY"),this.$datePicker.data("DateTimePicker").viewMode("years")},n.prototype.setValue=function(t){this.reset(),t&&this.$datePicker.data("DateTimePicker").date(new Date(t,0,1))},n.prototype.getValue=function(){var t=this.$datePicker.data("DateTimePicker").date();return t?""+t.year():""},n.prototype.validate=function(){var t=this.getValue();return this.mandatory&&!t?this.ERROR_NULL:t?t<this.config.yMin?this.ERROR_OUT_OF_RANGE:t>this.config.yMax?this.ERROR_OUT_OF_RANGE:void 0:null},n}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e){t.exports='<div id=divRowEditorPopup class=modal data-backdrop=false> <div class="modal-dialog modal-lg"> <div class=modal-content> <div class=modal-body> <table id=tblRowEditor> <tbody></tbody> </table> </div> <div class=modal-footer> <button id=btnEditRowCanc type=button class="btn btn-default"><span class="glyphicon glyphicon-remove"></span></button> <button id=btnEditRowOk type=button class="btn btn-primary"><span class="glyphicon glyphicon-ok"></span></button> </div> </div> </div> </div> <div id=divDataGrid> <table id=tblData class="table table-bordered table-condensed"> <thead> <tr id=tblDataHead></tr> </thead> <tbody id=tblDataBody></tbody> </table> </div>'},function(t,e){},function(t,e){t.exports=s},function(t,e,i){var n,o;n=[i(2),i(4)],o=function(t,e){var i=function(t){this.lang=t,this.$valResGrid};return i.prototype.render=function(t){this.$valResGrid=t},i.prototype.setValidationResults=function(t){if(this.$valResGrid.html(),t){var i="";console.log(this.lang,e),i="<table><tbody>";for(var n=0;n<t.length;n++)i+="<tr><td>",i+=e[this.lang.toLowerCase()][t[n].error],t[n].dataIndex&&(i+=" line: "+t[n].dataIndex),i+="</tr></td>";i+="</table></tbody>",this.$valResGrid.html(i)}},i}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,i){var o,a;o=[i(2),i(28)],a=function(t,e){function i(){}var o="nullKey",a="sameKeyVals",r="unknownCode",s="invalidYear",d="invalidMonth",l="invalidDate",c="invalidNumber",u="invalidBool";i.prototype.validate=function(t,e,i){var n=[],o=this.checkEmptyKeyVals(t,i),a=this.checkDuplicateKeyVals(t,i),r=this.checkWrongDataTypes(t,e,i),s=this.checkValueFlags();return o&&o.length>0&&w(n,o),a&&a.length>0&&w(n,a),r&&r.length>0&&w(n,r),s&&s.length>0&&w(n,s),n},i.prototype.checkEmptyKeyVals=function(t,e){if(!t||!e)return null;for(var i=[],n=0;n<e.length;n++)for(var a=0;a<t.length;a++)t[a].key&&(e[n][a]||i.push({error:o,colId:t[a].id,dataIndex:n}));return i},i.prototype.checkDuplicateKeyVals=function(t,e){if(!t||!e)return null;for(var i=[],n=0;n<e.length-1;n++)for(var o=n+1;o<e.length;o++)h(e[n],e[o],t)&&(i.push({error:a,dataIndex:n}),i.push({error:a,dataIndex:o}));return i};var h=function(t,e,i){for(var n=0;n<i.length;n++)if(i[n].key&&t[n]!=e[n])return!1;return!0};i.prototype.checkWrongDataTypes=function(t,e,i){if(!t||!i)return null;for(var n=[],o=0;o<i.length;o++)w(n,p(t,e,i[o],o));return n};var p=function(t,e,i,n){for(var o=[],a=0;a<t.length;a++)switch(t[a].dataType){case"code":var h=t[a].domain.codes[0].idCodeList;t[a].domain.codes[0].version&&(h=h+"|"+t[a].domain.codes[0].version),f(i[a],e[h])||o.push({error:r,dataIndex:n,colId:t[a].id});break;case"year":v(i[a])?t[a].domain&&t[a].domain.period&&(t[a].domain.period.from&&i[a]<t[a].domain.period.from&&o.push({error:s,dataIndex:n,colId:t[a].id,yearLimitFrom:t[a].domain.period.from,yearValue:i[a]}),t[a].domain.period.to&&i[a]>t[a].domain.period.to&&o.push({error:s,dataIndex:n,colId:t[a].id,yearLimitTo:t[a].domain.period.to,yearValue:i[a]})):o.push({error:s,dataIndex:n,colId:t[a].id});break;case"month":y(i[a])||o.push({error:d,dataIndex:n,colId:t[a].id});break;case"date":g(i[a])||o.push({error:l,dataIndex:n,colId:t[a].id});break;case"customCode":break;case"number":case"percentage":b(i[a])||o.push({error:c,dataIndex:n,colId:a});break;case"bool":m(i[a])||o.push({error:u,dataIndex:n,colId:a})}return o},f=function(t,i){var n=new e,t=n.findCodeInCodelist(t,i);return null!=t},v=function(e){return!e||!!t.isNumeric(e)&&4==e.toString().length},y=function(e){return!e||!!t.isNumeric(e)&&(6==e.toString().length&&!(e.substring(4,6)>12||e.substring(4,6)<1))},g=function(e){return!e||!!t.isNumeric(e)&&(8==e.toString().length&&!(e.substring(4,6)>12||e.substring(4,6)<1))};i.prototype.checkValueFlags=function(t,e){};var b=function(e){return!e||(""==e||!!t.isNumeric(e))},m=function(t){return"boolean"==typeof t||("string"==typeof t&&("true"==t||"false"==t)||"number"==typeof t&&(1==t||0==t))},w=function(t,e){if(t||(t=[]),e)for(var i=0;i<e.length;i++)t.push(e[i])};i.prototype.dataAppendCheck=function(t,e,i){if(!t||!e||!i)return null;for(var o=[],a=0;a<e.length;a++)for(n=0;n<i.length;n++){var r=h(e[a],i[n],t);r&&o.push({dataOldIndex:a,dataNewIndex:n})}return o},i.prototype.dataMerge=function(t,e,i,n){for(var o=e.length,a=0;a<i.length;a++){for(var r=!1,s=0;s<o;s++)h(e[s],i[a],t)&&(r=!0,"keepOld"==n||"keepNew"==n&&E(i[a],e[s]));r||e.push(i[a])}return e};var E=function(t,e){for(var i=0;i<t.length;i++)e[i]=t[i]};return i}.apply(e,o),
!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,o;n=[i(2)],o=function(t){function e(){}function i(t,e){for(var n=0;n<t.length;n++)if(t[n].code==e)return t[n];var o=null;for(n=0;n<t.length&&null==o;n++)t[n].children&&(o=i(t[n].children,e));return o}return e.prototype.findCodeInCodelist=function(t,e){var n=i(e.data,t);return n},e}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e){t.exports='<div id=divValRes style=display:none></div> <div id=DataUploadColsMatch style=display:none> <div class=row> <div class=col-xs-12> <p id=DataMatchColumn> Match the DSD columns with the CSV ones </p> <div id=divCsvMatcher> </div> <p> <button id=btnCsvMatcherOk type=button class=btn>Ok</button> <button id=btnCsvMatcherCancel type=button class=btn>Cancel</button> </p> </div> </div> </div> <div id=DataUploadContainer style=display:none> <div class=row> <div class=col-xs-12> <p id=DataDuplicateFound class=text-center> Some duplicated values found, keep old data or replace with the new values just uploaded? </p> <p class=text-center> <button id=btnDataMergeKeepNew type=button class=btn>Replace with new values</button> <button id=btnDataMergeKeepOld type=button class=btn>Keep old values</button> <button id=btnDataMergeCancel type=button class=btn>Cancel</button> </p> </div> </div> </div> <div id=divDataEditor> <div id=divDataEdit> </div> <div id=divDataGridBtns> <button id=btnAddRow type=button class="btn btn-default"><span class="glyphicon glyphicon-plus"></span></button> </div> </div> '},function(t,e,n){var o,a;o=[n(2)],a=function(t){function e(e,i){this.config={fSep:i,rSep:"\r\n",quot:'"',head:!1,trim:!0},t.extend(!0,this.config,e),this.stringsArr}function n(t){for(var e=t[0].length-1;e>=0;e--)""==t[0][e].trim()&&o(t,e)}function o(t,e){for(var i=0;i<t.length;i++)t[i].splice(e,1)}function a(t){if(!t)throw new Error("Nothing to parse");if(!t[0])throw new Error("Nothing to parse");return t[0]}function r(t){var e=[];for(i=1;i<t.length;i++)e.push(t[i]);return e}function s(t,e){for(var i=[[""]],n=f=p=q=0;p<t.length;p++)switch(c=t.charAt(p)){case e.quot:q&&t.charAt(p+1)==e.quot?(i[n][f]+=e.quot,++p):q^=1;break;case e.fSep:q?i[n][f]+=c:(e.trim&&(i[n][f]=i[n][f].replace(/^\s\s*/,"").replace(/\s\s*$/,"")),i[n][++f]="");break;case e.rSep.charAt(0):q||e.rSep.charAt(1)&&(!e.rSep.charAt(1)||e.rSep.charAt(1)!=t.charAt(p+1))?i[n][f]+=c:(e.trim&&(i[n][f]=i[n][f].replace(/^\s\s*/,"").replace(/\s\s*$/,"")),i[++n]=[""],i[n][f=0]="",e.rSep.charAt(1)&&++p);break;default:i[n][f]+=c}return e.head&&i.shift(),i[i.length-1].length<i[0].length&&i.pop(),i}return this.defConfig={fSep:",",rSep:"\r\n",quot:'"',head:!1,trim:!0},e.prototype.convert=function(t){this.stringsArr=s(t,this.config),n(this.stringsArr)},e.prototype.getColumns=function(){return a(this.stringsArr)},e.prototype.getData=function(){return r(this.stringsArr)},e}.apply(e,o),!(void 0!==a&&(t.exports=a))},function(t,e,n){var o,a;o=[n(2),n(32),n(28)],a=function(t,e,n){function o(){}function a(t){return"code"==t||("number"==t||"pecentage"==t)}function r(t,e){var i=new n,o=i.findCodeInCodelist(e,t);return null!=o}return o.prototype.validate=function(t,n,o,r){var s=[];if(!t)return s.push({type:e.DSD_COLUMNS_NULL}),s;if(!o)return s.push({type:e.CSV_COLUMNS_NULL}),s;if(t.length>o.length)return s.push({type:e.WRONG_COLUMN_COUNT}),s;var d=0;for(i=0;i<t.length;i++)if(a(t[i].dataType))for(d=0;d<r.length;d++)""==r[d][i]&&(r[d][i]=null);return s},o.prototype.validateCodes=function(t,n,o,a){var r=[];if(null==a||0==a.length)return r;if(null==o||0==o.length)return r;for(i=0;i<t.length;i++)if("code"==t[i].dataType){var s=t[i].domain.codes[0].idCodeList;t[i].domain.codes[0].version&&(s+="|"+t[i].domain.codes[0].version);var d=this.checkCodes(t[i],n[s],a,i);d.length>0&&r.push({type:e.UNKNOWN_CODES,columnId:o[i],codes:d,codelistId:s})}return r},o.prototype.checkCodes=function(e,i,n,o){for(var a=[],s=0;s<n.length;s++)if(n[s][o]){var d=r(i,n[s][o]);if(!d){var l=n[s][o];t.inArray(l,a)==-1&&a.push(l)}}return a},new o}.apply(e,o),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,o;n=[],o=function(){"use strict";var t={DSD_COLUMNS_NULL:"nullDSDCols",CSV_COLUMNS_NULL:"nullCsvCols",WRONG_COLUMN_COUNT:"wrongColumnCount",UNKNOWN_CODES:"unknownCodes"};return t}.apply(e,n),!(void 0!==o&&(t.exports=o))},function(t,e,n){var o,a;o=[n(2),n(8),n(34),n(24)],a=function(t,e,n,o){function a(t,e){for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1}function r(t,e){for(var i="",n=0;n<e.length;n++)i+="<td>",i+=t[e[n]],i+="</td>";return i}var s={maxRows:5},d={trDSD:"#trDSD",trCSV:"#trCSV",tblColMatch:"#tblColMatch"},l={rowDSD:"<td>%title%<br/>type: %type%</td>",rowCSV:'<td class="csvHead" style="cursor:move;" draggable="true"><div id="%colId%" draggable="true">%colId%</div></td>'},c=function(i){e.info("ColumnsMatch",i),this.config={},t.extend(!0,this.config,s,i),this.$cnt,this.$tblColMatch,this.$trDsd,this.$trCsv,this.dsd,this.csvCols,this.csvData,this.lang="EN"};return c.prototype.render=function(i,o,a){e.info("ColumnsMatch render",i,o,a),t.extend(!0,this.config,o),this.$cnt=i,this.$cnt.html(n),this.$tblColMatch=this.$cnt.find(d.tblColMatch),this.$trDsd=this.$cnt.find(d.trDSD),this.$trCsv=this.$cnt.find(d.trCSV),this._bindEvents(),this._doML(),a&&a()},c.prototype.setData=function(t,i,n){e.info("ColumnsMatch setData",t,i,n),this.dsd=t,this.csvCols=i,this.csvData=n;var o=t.columns;if(this.$trDsd.html(""),this.$trCsv.html(""),o){for(var a=0;a<o.length;a++){var r=o[a].title[this.lang],s=l.rowDSD.replace("%title%",r);s=s.replace("%type%",o[a].dataType),this.$trDsd.append(s)}for(a=0;a<i.length;a++)s=l.rowCSV.replace("%colId%",i[a]),s=s.replace("%colId%",i[a]),this.$trCsv.append(s),this.bindCsvHeadEvents();this._updateView(this.csvCols,this.csvData)}},c.prototype.getCsvCols=function(){e.info("ColumnsMatch getCsvCols");for(var t=this._getColIndexes(this.csvCols),i=[],n=0;n<this.dsd.columns.length;n++)i[n]=this.csvCols[t[n]];return i},c.prototype.getCsvData=function(){e.info("ColumnsMatch getCsvData");for(var t=this._getColIndexes(this.csvCols),i=[],n=0;n<this.csvData.length;n++){for(var o=[],a=0;a<this.dsd.columns.length;a++)o[a]=this.csvData[n][t[a]];i[n]=o}return i},c.prototype._updateView=function(t,n){e.info("ColumnsMatch _updateView",t,n);var o=this.config.maxRows;n.length<o&&(o=n.length),this._removeDataRows();var a=this._getColIndexes(t),s="";for(i=0;i<o;i++)s+="<tr>"+r(n[i],a)+"</tr>";for(s+="<tr>",i=0;i<a.length;i++)s+="<td>...</td>";s+="</tr>",this.$tblColMatch.append(s)},c.prototype._getColIndexes=function(i){e.info("ColumnsMatch _getColIndexes",i);for(var n=this.$trCsv.find("td"),o=[],r=0;r<n.length;r++){var s=t(n[r]).find("div")[0].id;o[r]=a(s,i)}return e.info("ColumnsMatch _getColIndexes<",o),o},c.prototype._removeDataRows=function(){var t=this.$tblColMatch.find("tr");if(t.length>2)for(var e=2;e<t.length;e++)t[e].remove()},c.prototype._bindEvents=function(){},c.prototype.bindCsvHeadEvents=function(){for(var e=this.$trCsv.find(".csvHead"),i=this,n=0;n<e.length;n++)t(e[n]).on("drop",function(t){i.drop(t)}),t(e[n]).on("dragover",i.allowDrop),t(e[n]).find("div").on("dragover",i.allowDrop),t(e[n]).find("div").on("dragstart",i.drag)},c.prototype._doML=function(){},c.prototype.drag=function(t){t.originalEvent.dataTransfer.setData("text",t.target.id)},c.prototype.allowDrop=function(t){t.preventDefault()},c.prototype.drop=function(e){e.preventDefault();var i,n,o=e.originalEvent.dataTransfer.getData("text"),a=t("div#"+o),r=a.parent();t(e.target).is("div")?(i=t(e.target),n=i.parent()):(n=t(e.target),i=n.find("div")),i.remove(),a.remove(),n.append(a),r.append(i),this._updateView(this.csvCols,this.csvData),this.bindCsvHeadEvents()},c}.apply(e,o),!(void 0!==a&&(t.exports=a))},function(t,e){t.exports='<table id=tblColMatch class="table table-bordered"> <tbody> <tr id=trDSD></tr> <tr id=trCSV></tr> </tbody> </table>'}])});
//# sourceMappingURL=fenix-ui-DataEditor.min.js.map